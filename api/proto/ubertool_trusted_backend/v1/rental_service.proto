syntax = "proto3";

package ubertool.trusted.api.v1;

option go_package = "ubertool-backend-trusted/api/gen/v1;ubertool_v1";


option java_multiple_files = true;
option java_package = "com.ubertool.trusted.api.v1";
option java_outer_classname = "RentalServiceProto";

// Rental service
service RentalService {
  // Create rental request (renter)
  rpc CreateRentalRequest(CreateRentalRequestRequest) returns (CreateRentalRequestResponse);

  // Approve rental request (owner)
  rpc ApproveRentalRequest(ApproveRentalRequestRequest) returns (ApproveRentalRequestResponse);

  // Reject rental request (owner)
  rpc RejectRentalRequest(RejectRentalRequestRequest) returns (RejectRentalRequestResponse);

  // Finalize approved rental request (renter)
  rpc FinalizeRentalRequest(FinalizeRentalRequestRequest) returns (FinalizeRentalRequestResponse);

  // Cancel rental (renter)
  rpc CancelRental(CancelRentalRequest) returns (CancelRentalResponse);

  // Complete rental (mark as returned, both sides)
  rpc CompleteRental(CompleteRentalRequest) returns (CompleteRentalResponse);
  // TODO: Dispute rental (both sides) should be in a designated dispute service

  // Get rental details (both sides)
  rpc GetRental(GetRentalRequest) returns (GetRentalResponse);

  // List lendings (owner)
  rpc ListMyLendings(ListMyLendingsRequest) returns (ListRentalsResponse);

  // List rentals (renter)
  rpc ListMyRentals(ListMyRentalsRequest) returns (ListRentalsResponse);
}

// Create rental request
message CreateRentalRequestRequest {
  int32 tool_id = 1;
  string start_date = 2; // Date string YYYY-MM-DD
  string end_date = 3; // Date string YYYY-MM-DD
  int32 organization_id = 4;
}

// Create rental request response
message CreateRentalRequestResponse {
  RentalRequest rental_request = 1;
}

// Approve rental request
message ApproveRentalRequestRequest {
  int32 request_id = 1;
  string pickup_instructions = 2;
}

// Approve rental request response
message ApproveRentalRequestResponse {
  RentalRequest rental_request = 1;
}

// Reject rental request
message RejectRentalRequestRequest {
  int32 request_id = 1;
  string reason = 2;
}

// Reject rental request response
message RejectRentalRequestResponse {
  bool success = 1;
  RentalRequest rental_request = 2;
}

message CancelRentalRequest {
  int32 request_id = 1;
  string reason = 2;
}
message CancelRentalResponse {
  bool success = 1;
  RentalRequest rental_request = 2;
}

// Complete rental
message CompleteRentalRequest {
  int32 request_id = 1;
}

// Complete rental response
message CompleteRentalResponse {
  RentalRequest rental_request = 1;
}

// Get rental request
message GetRentalRequest {
  int32 request_id = 1;
}

// Get rental response
message GetRentalResponse {
  RentalRequest rental_request = 1;
}

// List my rentals request
message ListMyRentalsRequest {
  int32 organization_id = 1;           // Organization context
  RentalStatus status = 2;             // Filter by status (optional, 0 = all)
  int32 page = 3;
  int32 page_size = 4;
}

// List my rentals response
message ListRentalsResponse {
  repeated RentalRequest rentals = 1;
  int32 total_count = 2;
}

// List my lendings request
message ListMyLendingsRequest {
  int32 organization_id = 1;           // Organization context
  RentalStatus status = 2;             // Filter by status (optional, 0 = all)
  int32 page = 3;
  int32 page_size = 4;
}

message FinalizeRentalRequestRequest {
  int32 request_id = 1;
  int32 user_id = 2;
}

message FinalizeRentalRequestResponse {
  RentalRequest rental_request = 1;
  repeated RentalRequest approved_rentals = 2;
  repeated RentalRequest pending_rentals = 3;
}


// Rental request message
message RentalRequest {
  int32 id = 1;
  int32 tool_id = 2;
  string tool_name = 3;
  int32 renter_id = 4;
  string renter_name = 5;
  int32 owner_id = 6;
  string owner_name = 7;
  int32 organization_id = 8;
  string start_date = 9; // Date string YYYY-MM-DD
  string end_date = 10; // Date string YYYY-MM-DD
  int32 total_cost_cents = 11;
  RentalStatus status = 12;
  string pickup_instructions = 13;
  string created_on = 14; // Date string YYYY-MM-DD
  string updated_on = 15; // Date string YYYY-MM-DD
}

// Rental status enum
enum RentalStatus {
  RENTAL_STATUS_UNSPECIFIED = 0;
  RENTAL_STATUS_PENDING = 1;
  RENTAL_STATUS_APPROVED = 2;
  RENTAL_STATUS_SCHEDULED = 3;
  RENTAL_STATUS_ACTIVE = 4;
  RENTAL_STATUS_COMPLETED = 5;
  RENTAL_STATUS_CANCELLED = 6;
  RENTAL_STATUS_OVERDUE = 7;
}

